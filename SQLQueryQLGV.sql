CREATE TABLE HOCVIEN (
    MAHV CHAR(5) PRIMARY KEY,
    HO VARCHAR(40),
    TEN VARCHAR(10),     
    NGSINH SMALLDATETIME,      
    GIOITINH VARCHAR(3),
    NOISINH VARCHAR(40),
    MALOP CHAR(3)
);
CREATE TABLE LOP (
    MALOP CHAR(3) PRIMARY KEY,
    TENLOP VARCHAR(40),
    TRGLOP CHAR(5),
    SISO TINYINT,
    MAGVCN CHAR(4),
);



CREATE TABLE KHOA (
    MAKHOA VARCHAR(4) PRIMARY KEY,
    TENKHOA VARCHAR(40),
    NGTLAP SMALLDATETIME,
    TRGKHOA CHAR(4),
);

CREATE TABLE MONHOC (
    MAMH VARCHAR(10) PRIMARY KEY,
    TENMH VARCHAR(40),
    TCLT TINYINT,
    TCTH TINYINT,
    MAKHOA VARCHAR(4),
    FOREIGN KEY (MAKHOA) REFERENCES KHOA(MAKHOA)
);

CREATE TABLE DIEUKIEN (
    MAMH VARCHAR(10),
    MAMH_TRUOC VARCHAR(10),
    PRIMARY KEY (MAMH, MAMH_TRUOC),
    FOREIGN KEY (MAMH) REFERENCES MONHOC(MAMH),
    FOREIGN KEY (MAMH_TRUOC) REFERENCES MONHOC(MAMH)
);

CREATE TABLE GIAOVIEN (
    MAGV CHAR(4) PRIMARY KEY,
    HOTEN VARCHAR(40),
    HOCVI VARCHAR(10),
    HOCHAM VARCHAR(10),
    GIOITINH VARCHAR(3),
    NGSINH SMALLDATETIME,
    NGVL SMALLDATETIME,
    HESO NUMERIC(4,2),
    MUCLUONG MONEY,
    MAKHOA VARCHAR(4),
    FOREIGN KEY (MAKHOA) REFERENCES KHOA(MAKHOA)
);

CREATE TABLE GIANGDAY (
    MALOP CHAR(3),
    MAMH VARCHAR(10),
    MAGV CHAR(4),
    HOCKY TINYINT,
    NAM SMALLINT,
    TUNGAY SMALLDATETIME,
    DENNGAY SMALLDATETIME,
    PRIMARY KEY (MALOP, MAMH, MAGV, HOCKY, NAM),
    FOREIGN KEY (MALOP) REFERENCES LOP(MALOP),
    FOREIGN KEY (MAMH) REFERENCES MONHOC(MAMH),
    FOREIGN KEY (MAGV) REFERENCES GIAOVIEN(MAGV)
);

CREATE TABLE KETQUATHI (
    MAHV CHAR(5),
    MAMH VARCHAR(10),
    LANTHI TINYINT,
    NGTHI SMALLDATETIME,
    DIEM NUMERIC(4,2),
    KQUA VARCHAR(10),
    PRIMARY KEY (MAHV, MAMH, LANTHI),
    FOREIGN KEY (MAHV) REFERENCES HOCVIEN(MAHV),
    FOREIGN KEY (MAMH) REFERENCES MONHOC(MAMH)
);

ALTER TABLE HOCVIEN
ADD CONSTRAINT FK_HOCVIEN_LOP
FOREIGN KEY (MALOP)
REFERENCES LOP(MALOP);

ALTER TABLE LOP
ADD CONSTRAINT FK_LOP_GIAOVIEN
FOREIGN KEY (MAGVCN)
REFERENCES GIAOVIEN(MAGV);

ALTER TABLE KHOA
ADD CONSTRAINT FK_KHOA_GIAOVIEN
FOREIGN KEY (TRGKHOA)
REFERENCES GIAOVIEN(MAGV);

--Em sẽ insert dữ liệu của các thuộc tính khóa chính và thuộc tính thường trước và insert dữ liệu của khóa ngoại sau để tránh lỗi

INSERT INTO KHOA (MAKHOA, TENKHOA, NGTLAP) 
VALUES 
('KHMT', 'Khoa hoc may tinh', '2005-06-07'),
('HTTT', 'He thong thong tin', '2005-06-07'),
('CNPM', 'Cong nghe phan mem', '2005-06-07'),
('MTT', 'Mang va truyen thong', '2005-10-20'),
('KTMT', 'Ky thuat may tinh', '2005-12-20');

INSERT INTO KHOA (TRGKHOA)
VALUES 
('GV01'),
('GV02'),
('GV04'),
('GV03'),
(NULL);




INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG)
VALUES
('GV01', 'Ho Thanh Son', 'PTS', 'GS', 'Nam', '1950-02-05', '2004-11-11', 5.00, 2250000),
('GV02', 'Tran Tam Thanh', 'TS', 'PGS', 'Nam', '1965-12-17', '2004-04-20', 4.50, 2025000),
('GV03', 'Do Nghiem Phung', 'TS', 'GS', 'Nu', '1950-08-01', '2004-09-23', 4.00, 1800000),
('GV04', 'Tran Nam Son', 'TS', 'PGS', 'Nam', '1961-01-22', '2005-01-12', 4.50, 2025000),
('GV05', 'Mai Thanh Danh', 'ThS', 'GV', 'Nam', '1958-03-12', '2005-01-12', 3.00, 1350000),
('GV06', 'Tran Doan Hung', 'TS', 'GV', 'Nam', '1953-11-03', '2005-01-12', 4.50, 2025000),
('GV07', 'Nguyen Minh Tien', 'ThS', 'GV', 'Nam', '1971-11-23', '2005-03-01', 4.00, 1800000),
('GV08', 'Le Thi Tran', 'KS', NULL, 'Nu', '1974-03-26', '2005-03-01', 1.69, 760500),
('GV09', 'Nguyen To Lan', 'ThS', 'GV', 'Nu', '1966-12-31', '2005-03-01', 4.00, 1800000),
('GV10', 'Le Tran Anh Loan', 'KS', NULL, 'Nu', '1972-07-17', '2005-03-01', 1.86, 837000),
('GV11', 'Ho Thanh Tung', 'CN', 'GV', 'Nam', '1980-12-01', '2005-05-15', 2.67, 1201500),
('GV12', 'Tran Van Anh', 'CN', NULL, 'Nam', '1981-03-29', '2005-05-15', 1.69, 760500),
('GV13', 'Nguyen Linh Dan', 'CN', NULL, 'Nu', '1980-05-23', '2005-05-15', 1.69, 760500),
('GV14', 'Truong Minh Chau', 'ThS', 'GV', 'Nu', '1976-11-30', '2005-05-15', 3.00, 1350000),
('GV15', 'Le Ha Thanh', 'ThS', 'GV', 'Nam', '1978-04-05', '2005-05-15', 3.00, 1350000);



UPDATE GIAOVIEN SET MAKHOA = 'KHMT' WHERE MAGV = 'GV01';
UPDATE GIAOVIEN SET MAKHOA = 'HTTT' WHERE MAGV = 'GV02';
UPDATE GIAOVIEN SET MAKHOA = 'CNPM' WHERE MAGV = 'GV03';
UPDATE GIAOVIEN SET MAKHOA = 'KTMT' WHERE MAGV = 'GV04';
UPDATE GIAOVIEN SET MAKHOA = 'HTTT' WHERE MAGV = 'GV05';
UPDATE GIAOVIEN SET MAKHOA = 'KHMT' WHERE MAGV = 'GV06';
UPDATE GIAOVIEN SET MAKHOA = 'KHMT' WHERE MAGV = 'GV07';
UPDATE GIAOVIEN SET MAKHOA = 'KHMT' WHERE MAGV = 'GV08';
UPDATE GIAOVIEN SET MAKHOA = 'HTTT' WHERE MAGV = 'GV09';
UPDATE GIAOVIEN SET MAKHOA = 'CNPM' WHERE MAGV = 'GV10';
UPDATE GIAOVIEN SET MAKHOA = 'MTT' WHERE MAGV = 'GV11';
UPDATE GIAOVIEN SET MAKHOA = 'CNPM' WHERE MAGV = 'GV12';
UPDATE GIAOVIEN SET MAKHOA = 'KTMT' WHERE MAGV = 'GV13';
UPDATE GIAOVIEN SET MAKHOA = 'MTT' WHERE MAGV = 'GV14';
UPDATE GIAOVIEN SET MAKHOA = 'KHMT' WHERE MAGV = 'GV15';





